#   current issues: Demo IFV does not detonate despite attacking
IFV:
	Inherits: ^TrackedVehicle
	Inherits@AUTOTARGET: ^AutoTargetAllAssaultMove
	Inherits@Crates: ^AcceptsAllCrates
	Inherits@TRANSPORT: ^Transport
	Valued:
		Cost: 600
    -Tooltip:
	Tooltip@Default:
		Name: Infantry Fighting Vehicle
        GenericStancePrefix: false
        GenericName: IFV
        GenericVisibility: Ally, Neutral, Enemy
        RequiresCondition: !loaded || nochange
	Tooltip@E1Inside:
		Name: Gunner Infantry Fighting Vehicle
        GenericStancePrefix: false
        GenericName: Gunner IFV
        GenericVisibility: Ally, Neutral, Enemy
        RequiresCondition: gunnerinside
	Tooltip@E3Inside:
		Name: Missile Infantry Fighting Vehicle
        GenericStancePrefix: false
        GenericName: Missile IFV
        GenericVisibility: Ally, Neutral, Enemy
        RequiresCondition: rocketinside
	Tooltip@E6Inside:
		Name: Repair Infantry Fighting Vehicle
        GenericStancePrefix: false
        GenericName: Repair IFV
        GenericVisibility: Ally, Neutral, Enemy
        RequiresCondition: engineerinside
	Tooltip@MediInside:
		Name: Medic Infantry Fighting Vehicle
        GenericStancePrefix: false
        GenericName: Medical IFV
        GenericVisibility: Ally, Neutral, Enemy
        RequiresCondition: medicinside
	Tooltip@SpyInside:
		Name: Recon Infantry Fighting Vehicle
        GenericStancePrefix: false
        GenericName: Recon IFV
        GenericVisibility: Ally, Neutral, Enemy
        RequiresCondition: spyinside
	Tooltip@RmboInside:
		Name: Commando Infantry Fighting Vehicle
        GenericStancePrefix: false
        GenericName: Commando IFV
        GenericVisibility: Ally, Neutral, Enemy
        RequiresCondition: commandoinside
	Tooltip@SnipInside:
		Name: Sniper Infantry Fighting Vehicle
        GenericStancePrefix: false
        GenericName: Sniper IFV
        GenericVisibility: Ally, Neutral, Enemy
        RequiresCondition: sniperinside
	Tooltip@E4Inside:
		Name: Flamer Infantry Fighting Vehicle
        GenericStancePrefix: false
        GenericName: Flamer IFV
        GenericVisibility: Ally, Neutral, Enemy
        RequiresCondition: flamerinside
	Tooltip@E5Inside:
		Name: Chemical Infantry Fighting Vehicle
        GenericStancePrefix: false
        GenericName: Chem IFV
        GenericVisibility: Ally, Neutral, Enemy
        RequiresCondition: chemicalinside
	Tooltip@SHOKInside:
		Name: Tesla Infantry Fighting Vehicle
        GenericStancePrefix: false
        GenericName: Tesla IFV
        GenericVisibility: Ally, Neutral, Enemy
        RequiresCondition: shockinside
	Tooltip@TERRInside:
		Name: Demolition Infantry Fighting Vehicle
        GenericStancePrefix: false
        GenericName: Demo IFV
        GenericVisibility: Ally, Neutral, Enemy
        RequiresCondition: bomberinside
	UpdatesPlayerStatistics:
		AddToArmyValue: true
	Buildable:
		BuildDuration: 900
        BuildDurationModifier: 100
		BuildPaletteOrder: 4
		Prerequisites: infantryproduction, ~vehicle.allies, ~player.bossallies, ~techlevel.4
		Queue: Vehicle
		Description: Adaptable infantry transport.\nCan carry one Infantry.\nArmament changes with Passenger.\n\nStrong vs Infantry.\nWeak vs Tanks.
	Mobile:
        Locomotor: tracked-crusher
		TurnSpeed: 12
		Speed: 90
		PauseOnCondition: notmobile || emp-crate-collected || boarding || pausefortesla
	Health:
		HP: 20000
	Armor:
		Type: Heavy
	RevealsShroud:
		Range: 5c128
	Armament@DEFAULT:
        Name: weapon-default
		Weapon: LightCannon
		Recoil: 85
		RecoilRecovery: 17
		LocalOffset: 768,0,90
		MuzzleSequence: muzzle
        PauseOnCondition: emp-crate-collected
        RequiresCondition: !loaded
	Armament@E1:
        Name: weapon-gunner
		Weapon: MachineGun
		MuzzleSequence: muzzle2
		LocalOffset: 540,0,90
		PauseOnCondition: emp-crate-collected
		RequiresCondition: gunnerinside
	Armament@E3Ground:
        Name: weapon-rockets
		Weapon: BikeRockets
		LocalOffset: 192,-100,176, 192,100,176
		LocalYaw: 64, -64
		PauseOnCondition: emp-crate-collected
        RequiresCondition: rocketinside
	Armament@E6:
        Name: weapon-engineer
		Weapon: Repair
		Cursor: fix
		OutsideRangeCursor: fix
		TargetRelationships: Ally
		ForceTargetRelationships: None
		PauseOnCondition: emp-crate-collected
		RequiresCondition: engineerinside
	Armament@RMBO:
        Name: weapon-commando
		Weapon: VulcanAPC
		MuzzleSequence: muzzle2
		LocalOffset: 321,0,85
		PauseOnCondition: emp-crate-collected
		RequiresCondition: commandoinside
	Armament@SNIP:
        Name: weapon-sniper
		Weapon: Sniper
		MuzzleSequence: muzzle2
		LocalOffset: 540,0,90
		PauseOnCondition: emp-crate-collected
		RequiresCondition: sniperinside
	Armament@E4:
        Name: weapon-flamer
		Weapon: PortaFireball
		LocalOffset: 321,0,85
		PauseOnCondition: emp-crate-collected
		RequiresCondition: flamerinside
	Armament@E5:
        Name: weapon-chemical
		Weapon: PortaChemball
		LocalOffset: 321,0,85
		PauseOnCondition: emp-crate-collected
		RequiresCondition: chemicalinside
	Armament@SHOK:
        Name: weapon-tesla
		Weapon: PortaTesla
		LocalOffset: 0,0,85
		FireDelay: 22
		PauseOnCondition: emp-crate-collected || !zapping
		RequiresCondition: shockinside
	Armament@TERR:
        Name: weapon-demolition
		Weapon: DemoIFVTargeting
		LocalOffset: 0,0,0
		PauseOnCondition: emp-crate-collected
		RequiresCondition: bomberinside
	GrantConditionOnAttack@TERR:
		Condition: triggered
		RequiresCondition: bomberinside
	Explodes@TERR:
		Weapon: FanaticExplode
		EmptyWeapon: FanaticExplode
		DamageSource: Killer
		Chance: 100
        RequiresCondition: bomberinside
    KillsSelf:
		RequiresCondition: bomberinside && triggered
	GrantConditionWhileAiming@SHOK:
		Condition: zapping
	GrantCondition@momentaryimmobilize:
		Condition: pausefortesla
		RequiresCondition: shockinside && zapping
	Turreted:
		TurnSpeed: 12
	AttackTurreted:
        Armaments: weapon-default, weapon-gunner, weapon-rockets, weapon-engineer, weapon-commando, weapon-sniper, weapon-flamer, weapon-chemical, weapon-tesla, weapon-demolition
        Voice: Attack
        PauseOnCondition: emp-crate-collected || spyinside
	WithSpriteTurret@Default:
        Sequence: turret
        RequiresCondition: !loaded
	WithSpriteTurret@E1Inside:
		RequiresCondition: gunnerinside || sniperinside
		Sequence: turret-mg
	WithSpriteTurret@E3Inside:
		RequiresCondition: rocketinside
		Sequence: turret-rocket
	WithSpriteTurret@E6Inside:
		RequiresCondition: engineerinside
		Sequence: turret-repair
	WithSpriteTurret@RmboInside:
		RequiresCondition: commandoinside
		Sequence: turret-rambo
	WithSpriteTurret@E4Inside:
		RequiresCondition: flamerinside
		Sequence: turret-flamer
	WithSpriteTurret@E5Inside:
		RequiresCondition: chemicalinside
		Sequence: turret-chemical
	WithIdleOverlay@SpyInside:
		Sequence: spinner
		Offset: -10,0,316
        PauseOnCondition: emp-crate-collected
        RequiresCondition: spyinside
	WithIdleOverlay@MedicInside:
		Sequence: medical
		Offset: 0,0,0
        RequiresCondition: medicinside
	WithIdleOverlay@ShockInside:
		Sequence: tsla-orb
		Offset: 0,0,0
        RequiresCondition: shockinside && !zapping
	WithIdleOverlay@ShockInside2:
		Sequence: tsla-orb-charge
		Offset: 0,0,0
        RequiresCondition: shockinside && zapping
	WithIdleOverlay@TerrInside:
		Sequence: red-light
		Offset: -10,0,216
        RequiresCondition: bomberinside
	AttackMove:
		Voice: Attack
	WithMuzzleOverlay:
	DetectCloaked@SpyInside:
        DetectionTypes: Stealth, Underground
		Range: 3c768
		RequiresCondition: spyinside
	RenderDetectionCircle:
	ProximityExternalCondition@MedicInside:
		Condition: barracks
		ValidRelationships: Ally
		Range: 1c826
		RequiresCondition: medicinside && !emp-crate-collected
	WithRangeCircle@MedicInside:
		Range: 1c826
		RequiresCondition: medicinside && !emp-crate-collected
	Cargo:
		Types: Infantry
		MaxWeight: 1
		UnloadVoice: Unload
        LoadingCondition: notmobile
        LoadedCondition: loaded
		PassengerConditions:
            e1: gunnerinside
            e2: nochange
            e3: rocketinside
            e6: engineerinside
            medi: medicinside
            mech: engineerinside
            spy: spyinside
			rmbo: commandoinside
            tany: commandoinside
            volk: commandoinside
            mega: commandoinside
            snip: sniperinside
            seal: gunnerinside
            e4: flamerinside
            e8: flamerinside
            e5: chemicalinside
            dog: spyinside
            shok: shockinside
            terr: bomberinside
            inf: spyinside
            thf: spyinside
            e9: nochange
            e9c: nochange
	WithDecoration@COMMANDOSKULL:
		Image: pips
		Sequence: pip-skull
		Palette: effect
		Position: TopLeft
		ValidRelationships: Ally
		RequiresCondition: commandoinside
	WithDecoration@CROSSHAIR:
		Image: pips
		Sequence: pip-sniper
		Palette: effect
		Position: TopLeft
		ValidRelationships: Ally
		RequiresCondition: sniperinside
	Explodes:
		Weapon: UnitExplodeBig
		EmptyWeapon: UnitExplodeBig
        RequiresCondition: !bomberinside
	Sellable:
		RequiresCondition: unit.sellable && !loaded
    Capturable:
        RequiresCondition: !loaded
    ExternalCondition@CloakingField:
        Condition: cloakfield-on
	Cloak@CloakingField:
        CloakType: Stealth
        DetectionTypes: Stealth
		InitialDelay: 90
		CloakDelay: 90
		UncloakSound: cloak5.aud
		Palette: cloaktransparent
		IsPlayerPalette: true
		UncloakOn: Attack, Move, Unload, Infiltrate, Demolish, Dock, Damage, Heal
		PauseOnCondition: cloak-force-disabled || cloak-crate-collected
		RequiresCondition: cloakfield-on
	RevealOnFire:
		ArmamentNames: weapon-default, weapon-gunner, weapon-rocket-ag, weapon-rocket-aa, weapon-commando, weapon-sniper. weapon-flamer, weapon-chemical
        RevealForRelationships: Ally, Neutral, Enemy
        RevealGeneratedShroud: false
        RequiresCondition: reveal-on
    GrantConditionOnPrerequisite@REVEALTOGGLE:
        Condition: reveal-on
        Prerequisites: ~global-unitreveal
